
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driving Change: TEDxDAU 2025 Crossword Puzzle</title>
  <style>
    /* Omitted for brevity: Copy your full CSS here from original file */
  </style>
</head>
<body>
  <h1>Driving Change: TEDxDAU 2025 Crossword Puzzle</h1>
  <img src="https://raw.githubusercontent.com/BelovedCoachP/tedxdau-crossword-puzzle/refs/heads/main/DrivingChange_1920x1080_external.png" alt="Driving Change Logo" class="header-image">

  <div class="buttons">
    <button id="check-button">Check Answers</button>
    <button id="reveal-button">Reveal Solution</button>
    <button id="reset-button">Reset Puzzle</button>
  </div>

  <div id="completion-message" class="completion-message">
    Congratulations! You've completed the puzzle!
  </div>

  <div class="crossword-container" id="crossword"></div>

  <div class="clue-lists">
    <div class="clue-list">
      <h2>Across</h2>
      <ol id="across-clues"></ol>
    </div>
    <div class="clue-list">
      <h2>Down</h2>
      <ol id="down-clues"></ol>
    </div>
  </div>

  <script>
    // Omitted: Include full puzzleData, other JS logic...
    
// PATCHED VERSION OF createCrosswordGrid()
function createCrosswordGrid() {
    const crosswordDiv = document.getElementById('crossword');
    const width = puzzleData.width;
    const height = puzzleData.height;

    crosswordDiv.innerHTML = '';

    const grid = Array(height).fill().map(() => Array(width).fill(false));
    const numberGrid = Array(height).fill().map(() => Array(width).fill(0));

    let clueNumber = 1;

    const validAnswers = puzzleData.answers.filter(answer => {
        const { row, col, direction, answer: word } = answer;
        if (row < 1 || row > height || col < 1 || col > width) {
            console.error(`Answer out of bounds: ${word} at position row=${row}, col=${col}`);
            return false;
        }
        if (direction === 'across' && col + word.length - 1 > width) {
            console.error(`Across word too long: ${word} at position row=${row}, col=${col}`);
            return false;
        }
        if (direction === 'down' && row + word.length - 1 > height) {
            console.error(`Down word too long: ${word} at position row=${row}, col=${col}`);
            return false;
        }
        return true;
    });

    // PATCH: Always assign clue number if start cell has 0
    validAnswers.forEach(answer => {
        const { row, col, direction, answer: word } = answer;

        if (numberGrid[row - 1][col - 1] === 0) {
            numberGrid[row - 1][col - 1] = clueNumber++;
        }

        for (let i = 0; i < word.length; i++) {
            if (direction === 'across') {
                grid[row - 1][col - 1 + i] = true;
            } else {
                grid[row - 1 + i][col - 1] = true;
            }
        }
    });

    validAnswers.forEach(answer => {
        const { row, col, direction, answer: word } = answer;
        const answerKey = `${direction}-${numberGrid[row - 1][col - 1]}`;
        correctAnswers[answerKey] = word;
    });

    for (let i = 0; i < height; i++) {
        for (let j = 0; j < width; j++) {
            const cell = document.createElement('div');
            cell.className = grid[i][j] ? 'crossword-cell' : 'crossword-cell black-cell';

            if (grid[i][j]) {
                const input = document.createElement('input');
                input.maxLength = 1;
                input.dataset.row = i + 1;
                input.dataset.col = j + 1;
                input.addEventListener('keydown', handleKeyDown);
                input.addEventListener('input', handleInput);
                cell.appendChild(input);

                if (numberGrid[i][j] > 0) {
                    const numberSpan = document.createElement('span');
                    numberSpan.className = 'cell-number';
                    numberSpan.textContent = numberGrid[i][j];
                    cell.appendChild(numberSpan);
                }
            }

            crosswordDiv.appendChild(cell);
        }
    }

    populateClueList('across-clues', puzzleData.clues.across);
    populateClueList('down-clues', puzzleData.clues.down);
}

    // Omitted: Include rest of script: checkAnswers, handleInput, etc.
  </script>
</body>
</html>
